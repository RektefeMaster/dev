import { device, element, by, expect as detoxExpect, waitFor } from 'detox';

describe('ðŸ”§ Mechanic Ana Sayfa', () => {
  beforeAll(async () => {
    });

  beforeEach(async () => {
    await device.reloadReactNative();
    await global.helpers.skipSplashScreen();
    await global.helpers.skipOnboarding();
    
    // Mechanic kullanÄ±cÄ±sÄ± ile giriÅŸ yap
    await global.helpers.loginUser(
      global.testData.users.testMechanic.email,
      global.testData.users.testMechanic.password
    );
  });

  describe('Ana Dashboard', () => {
    it('Mechanic dashboard bileÅŸenleri gÃ¶rÃ¼ntÃ¼leniyor', async () => {
      await waitFor(element(by.testID('mechanic-home-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('mechanic_home_loaded');
      
      // Ä°statistik kartlarÄ±
      await detoxExpect(element(by.testID('stats-cards'))).toBeVisible();
      
      // BugÃ¼nkÃ¼ randevular
      await detoxExpect(element(by.testID('todays-appointments'))).toBeVisible();
      
      // HÄ±zlÄ± eylemler
      await detoxExpect(element(by.testID('quick-actions'))).toBeVisible();
      
      // Gelir Ã¶zeti (varsa)
      try {
        await detoxExpect(element(by.testID('earnings-summary'))).toBeVisible();
        } catch {
        }
      
      });

    it('Ä°statistik kartlarÄ± doÄŸru bilgileri gÃ¶steriyor', async () => {
      await waitFor(element(by.testID('stats-cards')))
        .toBeVisible()
        .withTimeout(3000);
      
      // BugÃ¼nkÃ¼ randevu sayÄ±sÄ±
      await detoxExpect(element(by.testID('stat-todays-appointments'))).toBeVisible();
      
      // Bu haftaki iÅŸ sayÄ±sÄ±
      await detoxExpect(element(by.testID('stat-weekly-jobs'))).toBeVisible();
      
      // Toplam gelir
      await detoxExpect(element(by.testID('stat-total-earnings'))).toBeVisible();
      
      // MÃ¼ÅŸteri puanÄ±
      await detoxExpect(element(by.testID('stat-rating'))).toBeVisible();
      
      await global.helpers.takeScreenshot('mechanic_stats_cards');
      
      });

    it('BugÃ¼nkÃ¼ randevular listesi Ã§alÄ±ÅŸÄ±yor', async () => {
      await waitFor(element(by.testID('todays-appointments')))
        .toBeVisible()
        .withTimeout(3000);
      
      // Randevu listesini kontrol et
      try {
        await detoxExpect(element(by.testID('appointment-list'))).toBeVisible();
        
        // Ä°lk randevuya tÄ±kla (varsa)
        try {
          await element(by.testID('appointment-item-0')).tap();
          
          await waitFor(element(by.testID('appointment-detail-screen')))
            .toBeVisible()
            .withTimeout(5000);
          
          await global.helpers.takeScreenshot('appointment_detail_from_home');
          
          await element(by.testID('back-button')).tap();
          
          } catch {
          }
      } catch {
        // Randevu yoksa "BugÃ¼n randevunuz yok" mesajÄ± gÃ¶rÃ¼nmeli
        await detoxExpect(element(by.text('BugÃ¼n randevunuz bulunmamaktadÄ±r'))).toBeVisible();
        }
      
      await global.helpers.takeScreenshot('todays_appointments');
      
      });
  });

  describe('HÄ±zlÄ± Eylemler', () => {
    it('Randevu takvimi hÄ±zlÄ± eriÅŸim Ã§alÄ±ÅŸÄ±yor', async () => {
      await element(by.testID('quick-action-calendar')).tap();
      
      await waitFor(element(by.testID('calendar-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('calendar_from_quick_action');
      
      await element(by.testID('back-button')).tap();
      
      });

    it('Yeni randevu oluÅŸturma Ã§alÄ±ÅŸÄ±yor', async () => {
      await element(by.testID('quick-action-new-appointment')).tap();
      
      // Yeni randevu formuna yÃ¶nlendirildiÄŸini kontrol et
      await waitFor(element(by.testID('new-appointment-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('new_appointment_from_quick_action');
      
      await element(by.testID('back-button')).tap();
      
      });

    it('MÃ¼ÅŸteri mesajlarÄ± hÄ±zlÄ± eriÅŸim Ã§alÄ±ÅŸÄ±yor', async () => {
      await element(by.testID('quick-action-messages')).tap();
      
      await waitFor(element(by.testID('messages-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('messages_from_quick_action');
      
      await element(by.testID('back-button')).tap();
      
      });

    it('Gelir takibi hÄ±zlÄ± eriÅŸim Ã§alÄ±ÅŸÄ±yor', async () => {
      await element(by.testID('quick-action-earnings')).tap();
      
      await waitFor(element(by.testID('financial-tracking-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('earnings_from_quick_action');
      
      await element(by.testID('back-button')).tap();
      
      });
  });

  describe('Servis Kategorileri', () => {
    it('Tamir servisi kategorisi Ã§alÄ±ÅŸÄ±yor', async () => {
      // Scroll down to find service categories
      await global.helpers.scrollTo('mechanic-home-scroll', 'down');
      
      await element(by.testID('service-category-repair')).tap();
      
      await waitFor(element(by.testID('repair-service-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('repair_service_screen');
      
      await element(by.testID('back-button')).tap();
      
      });

    it('Lastik servisi kategorisi Ã§alÄ±ÅŸÄ±yor', async () => {
      await global.helpers.scrollTo('mechanic-home-scroll', 'down');
      
      await element(by.testID('service-category-tire')).tap();
      
      await waitFor(element(by.testID('tire-service-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('tire_service_screen');
      
      await element(by.testID('back-button')).tap();
      
      });

    it('Ã‡ekici servisi kategorisi Ã§alÄ±ÅŸÄ±yor', async () => {
      await global.helpers.scrollTo('mechanic-home-scroll', 'down');
      
      await element(by.testID('service-category-towing')).tap();
      
      await waitFor(element(by.testID('towing-service-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('towing_service_screen');
      
      await element(by.testID('back-button')).tap();
      
      });

    it('YÄ±kama servisi kategorisi Ã§alÄ±ÅŸÄ±yor', async () => {
      await global.helpers.scrollTo('mechanic-home-scroll', 'down');
      
      await element(by.testID('service-category-wash')).tap();
      
      await waitFor(element(by.testID('wash-service-screen')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('wash_service_screen');
      
      await element(by.testID('back-button')).tap();
      
      });
  });

  describe('Bildirimler ve GÃ¼ncellemeler', () => {
    it('Bildirim butonu Ã§alÄ±ÅŸÄ±yor', async () => {
      await element(by.testID('notification-button')).tap();
      
      await waitFor(element(by.testID('notifications-screen')))
        .toBeVisible()
        .withTimeout(3000);
      
      await global.helpers.takeScreenshot('mechanic_notifications');
      
      await element(by.testID('back-button')).tap();
      
      });

    it('Profil gÃ¼ncellemesi uyarÄ±sÄ± Ã§alÄ±ÅŸÄ±yor', async () => {
      try {
        // Profil gÃ¼ncelleme modalÄ±nÄ±n var olup olmadÄ±ÄŸÄ±nÄ± kontrol et
        await waitFor(element(by.testID('profile-update-modal')))
          .toBeVisible()
          .withTimeout(2000);
        
        await global.helpers.takeScreenshot('profile_update_modal');
        
        // "Daha sonra" butonuna tÄ±kla
        await element(by.testID('profile-update-later-button')).tap();
        
        } catch {
        }
    });
  });

  describe('Ã‡evrimdÄ±ÅŸÄ± Mod', () => {
    it('Ã‡evrimdÄ±ÅŸÄ± durumda uygun mesaj gÃ¶steriyor', async () => {
      // AÄŸ baÄŸlantÄ±sÄ±nÄ± kapat
      await device.setNetworkConnection('offline');
      
      // SayfayÄ± yenile
      await element(by.testID('mechanic-home-scroll')).swipe('down', 'fast', 0.8);
      
      // Ã‡evrimdÄ±ÅŸÄ± mesajÄ±nÄ± kontrol et
      await waitFor(element(by.text('Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edin')))
        .toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('offline_mode');
      
      // AÄŸ baÄŸlantÄ±sÄ±nÄ± tekrar aÃ§
      await device.setNetworkConnection('wifi');
      
      // SayfayÄ± tekrar yenile
      await element(by.testID('mechanic-home-scroll')).swipe('down', 'fast', 0.8);
      
      // Normal iÃ§eriÄŸin geri dÃ¶ndÃ¼ÄŸÃ¼nÃ¼ kontrol et
      await waitFor(element(by.testID('stats-cards')))
        .toBeVisible()
        .withTimeout(10000);
      
      });
  });

  describe('Pull-to-Refresh', () => {
    it('Ana sayfa yenileme Ã§alÄ±ÅŸÄ±yor', async () => {
      await waitFor(element(by.testID('mechanic-home-screen')))
        .toBeVisible()
        .withTimeout(3000);
      
      // Pull to refresh
      await element(by.testID('mechanic-home-scroll')).swipe('down', 'fast', 0.8);
      
      // Loading gÃ¶stergesi gÃ¶rÃ¼nmeli
      await waitFor(element(by.testID('refresh-loading')))
        .toBeVisible()
        .withTimeout(2000);
      
      // Loading bitmesini bekle
      await waitFor(element(by.testID('refresh-loading')))
        .not.toBeVisible()
        .withTimeout(5000);
      
      await global.helpers.takeScreenshot('mechanic_home_refreshed');
      
      });
  });

  describe('Responsive Design', () => {
    it('Tablet gÃ¶rÃ¼nÃ¼mÃ¼nde dÃ¼zgÃ¼n Ã§alÄ±ÅŸÄ±yor', async () => {
      // Landscape mode (tablet simulation)
      await device.setOrientation('landscape');
      
      await waitFor(element(by.testID('mechanic-home-screen')))
        .toBeVisible()
        .withTimeout(3000);
      
      await global.helpers.takeScreenshot('mechanic_home_landscape');
      
      // Ana bileÅŸenlerin hala gÃ¶rÃ¼nÃ¼r olduÄŸunu kontrol et
      await detoxExpect(element(by.testID('stats-cards'))).toBeVisible();
      await detoxExpect(element(by.testID('todays-appointments'))).toBeVisible();
      
      // Portrait moda geri dÃ¶n
      await device.setOrientation('portrait');
      
      await global.helpers.takeScreenshot('mechanic_home_portrait');
      
      });
  });
});
